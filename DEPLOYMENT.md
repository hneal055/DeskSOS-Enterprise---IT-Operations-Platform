# DESKSOS Production Deployment Guide

## Prerequisites

- Docker Desktop installed and running
- Docker Compose v2.0+
- Git for version control
- At least 4GB RAM available for containers

## Architecture Overview

`
┌─────────────────────────────────────────────────┐
│              Nginx (reverse proxy)               │
│         Port 80 → 443 (SSL redirect)             │
└─────────────┬───────────────────────────────────┘
              │
      ┌───────┴────────┐
      ▼                ▼
  ┌────────┐       ┌────────┐
  │ React  │       │ Node   │
  │ Client │       │ Server │
  │ (:3000)│       │ (:5000)│
  └───┬────┘       └───┬────┘
      │                │
      └────────┬───────┘
               ▼
        ┌──────────────┐
        │  PostgreSQL  │
        │  (:5432)     │
        └──────────────┘
        ┌──────────────┐
        │    Redis     │
        │  (:6379)     │
        └──────────────┘
`

## Directory Structure

\\\
DESKSOS-ENTERPRISE/
├── server/                      # Node.js backend
│   ├── src/
│   ├── Dockerfile
│   ├── package.json
│   └── tsconfig.json
├── renderer/server/src/routes/client/  # React frontend
│   ├── src/
│   ├── Dockerfile
│   ├── package.json
│   └── vite.config.ts
├── nginx/
│   ├── nginx.conf
│   └── conf.d/
│       └── default.conf
├── scripts/
│   └── generate-ssl.sh
├── ssl/                         # SSL certificates (generated at runtime)
├── docker-compose.prod.yml
├── .env.production
└── .gitignore
\\\

## Pre-Deployment Checklist

- [ ] Docker Desktop running
- [ ] All environment variables set in .env.production
- [ ] SSL certificates configured (auto-generated by Docker)
- [ ] Database backup created (if migrating)
- [ ] Backend Dockerfile tested locally
- [ ] Frontend Dockerfile tested locally

## Deployment Steps

### 1. Prepare Environment

\\\ash
# Navigate to project directory
cd C:\\Projects\\DESKSOS-ENTERPRISE

# Verify .env.production exists
ls .env.production

# Check SSL setup
ls ssl/
\\\

### 2. Build and Start Containers

\\\ash
# Build all images
docker-compose -f docker-compose.prod.yml build

# Start all services
docker-compose -f docker-compose.prod.yml up -d

# View logs
docker-compose -f docker-compose.prod.yml logs -f
\\\

### 3. Verify Deployment

\\\ash
# Check container status
docker-compose -f docker-compose.prod.yml ps

# Test backend health
curl http://localhost/health

# View nginx access logs
docker-compose -f docker-compose.prod.yml logs nginx

# Check database connection
docker-compose -f docker-compose.prod.yml exec postgres psql -U desksos_prod -d desksos_production -c "SELECT version();"
\\\

## Health Checks

All services include health checks:

- **PostgreSQL**: pg_isready check (30s interval)
- **Node Server**: HTTP GET /health (30s interval)
- **Nginx**: Monitors upstream availability

## Environment Variables

From **.env.production**:

| Variable | Purpose | Example |
|----------|---------|---------|
| DB_USER | PostgreSQL user | desksos_prod |
| DB_PASSWORD | DB password (32+ chars) | Xk9mL2pQvR7sT4uW6yB8cD1eF3gH5iJ7k |
| DB_NAME | Database name | desksos_production |
| JWT_SECRET | JWT signing key (64+ chars) | aB9cD3eF7kL1mN5oP8qR2sT6uV4wX8yZ_... |
| REDIS_PASSWORD | Redis auth (32+ chars) | Zm9rK3lN2aB9cD8eF1gH5iJ7k0sT4uW6x |
| NODE_ENV | Environment | production |
| PORT | Backend port | 5000 |

## SSL/TLS Configuration

- Self-signed certificates auto-generated on first run
- Located in ./ssl/ directory
- Valid for 365 days
- For production: Replace with Let's Encrypt certificates

### Replace SSL Certificates

\\\ash
# With Let's Encrypt (recommended for production)
docker-compose -f docker-compose.prod.yml run --rm certbot certonly --standalone -d your-domain.com

# Copy certificates
cp /etc/letsencrypt/live/your-domain.com/fullchain.pem ssl/cert.pem
cp /etc/letsencrypt/live/your-domain.com/privkey.pem ssl/key.pem
\\\

## Logging and Monitoring

### View Logs

\\\ash
# All services
docker-compose -f docker-compose.prod.yml logs

# Specific service
docker-compose -f docker-compose.prod.yml logs nginx
docker-compose -f docker-compose.prod.yml logs server

# Follow logs in real-time
docker-compose -f docker-compose.prod.yml logs -f
\\\

### Database Logs

\\\ash
docker-compose -f docker-compose.prod.yml exec postgres tail -f /var/log/postgresql/postgresql.log
\\\

## Troubleshooting

### Container won't start

\\\ash
# Check specific service logs
docker-compose -f docker-compose.prod.yml logs server

# Restart service
docker-compose -f docker-compose.prod.yml restart server
\\\

### Database connection failed

\\\ash
# Check database status
docker-compose -f docker-compose.prod.yml ps postgres

# Access database directly
docker-compose -f docker-compose.prod.yml exec postgres psql -U desksos_prod -d desksos_production
\\\

### Redis connection issues

\\\ash
# Check Redis status
docker-compose -f docker-compose.prod.yml exec redis redis-cli PING

# Check Redis logs
docker-compose -f docker-compose.prod.yml logs redis
\\\

## Maintenance

### Database Backups

\\\ash
# Create backup
docker-compose -f docker-compose.prod.yml exec postgres pg_dump -U desksos_prod desksos_production > backup-\.sql

# Restore backup
docker-compose -f docker-compose.prod.yml exec -T postgres psql -U desksos_prod desksos_production < backup-20240101-120000.sql
\\\

### Update Services

\\\ash
# Pull latest changes
git pull origin main

# Rebuild images
docker-compose -f docker-compose.prod.yml build --pull

# Restart services
docker-compose -f docker-compose.prod.yml up -d
\\\

### Clean Up

\\\ash
# Stop all services
docker-compose -f docker-compose.prod.yml down

# Remove volumes (WARNING: deletes data)
docker-compose -f docker-compose.prod.yml down -v

# Prune unused images
docker image prune -a
\\\

## Performance Tuning

### Nginx Optimization (already configured)
- Gzip compression for text, JSON, JS
- HTTP/2 support
- Static asset caching (1 year expires)
- Rate limiting: 10 req/s for API, 30 req/s for general

### PostgreSQL Tuning
- Connection pooling via PgBouncer (future enhancement)
- Query optimization with indexes
- Automated backups (future enhancement)

### Redis Optimization
- Persistence enabled
- Eviction policy: allkeys-lru
- AOF (Append-Only File) for durability

## Security Best Practices

✅ Implemented:
- HTTPS with TLS 1.2+
- Security headers (HSTS, X-Frame-Options, X-Content-Type-Options)
- Rate limiting on API endpoints
- Environment variable secrets (no hardcoded values)
- Container resource limits
- Non-root user in containers

⚠️ Additional Recommendations:
- Use different secrets for production (generate new passwords)
- Enable WAF (Web Application Firewall)
- Setup monitoring/alerting (Prometheus, Grafana)
- Enable database encryption
- Implement automated backups
- Setup log aggregation (ELK, Splunk)

## Support and Debugging

For issues:
1. Check \docker-compose logs\ for error messages
2. Verify .env.production variables are set
3. Ensure DNS is configured for custom domains
4. Check firewall rules for ports 80/443
5. Review nginx error logs: \/var/log/nginx/error.log\

## Next Steps

1. ✅ Backend API fully functional
2. ✅ Frontend React components integrated
3. ✅ Docker Compose production setup ready
4. ⏳ Deploy and test end-to-end
5. ⏳ Configure custom domain and SSL certificates
6. ⏳ Setup monitoring and alerting
7. ⏳ Database migrations and schema
